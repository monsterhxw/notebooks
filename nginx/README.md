# Nginx 日常记录

Nginx 是一个开源且高性能、可靠的 HTTP 中间件、代理服务。

## Nginx 配置 301/302 跳转

### 301 跳转

301 Moved Permanently，**永久重定向**。被请求资源已永久移动到新的位置，并且将来任何对该资源的引用都是使用本响应返回的若干个 URI 之一。**301 资源除非额外指定，否则都是可缓存的**。

**配置 301 跳转实现如下：**

```bash
server {
  server_name www.xxx.com;
  rewrite ^(.*)$ http://www.xxx.com$1 permanent;
}
```

**配置 HTTP 强制 301 跳转 HTTPS 实现如下：**

```bash
server {
  server_name www.xxx.com;
  listen 80;
  access_log off;
  error_log off;

  rewrite ^(.*)$ https://www.xxx.com${request_uri} permanent;
}
```

### 302 跳转

**302 Found 表示临时重定向 Moved Temporarily**。由于这样的重定向是临时的，客户端应继续向原有地址发送以后的请求，**只有在 Cache-Control 或 Expires 中进行了指定的情况下，这个响应才是可缓存的**。

**配置 302 跳转实现如下：**

```bash
server {
  server_name www.xxx.com;
  rewrite ^(.*)$ http://www.*.com$1 redirect;
}
```

### 301 跳转和 302 跳转相同点

1. 都表示资源重定向。

2. 新的 URI 地址都是在响应的 Location 中返回。

3. 如果原始请求不是 GET 或者 HEAD 请求的话，浏览器会禁止自动进行重定向，除非得到用户的确认，因为请求的条件可能因此发生变化。

### 正则解释

- **"." : 匹配除换行符以外的任意字符**
- **"?" : 重复 0 次或者 1 次**

- **"*" : 重复 0 次或者 0 次以上**
- **"+" : 重复 1 次或者 1 次以上**
- **"\d" : 匹配数字**
- **"^" : 匹配字符串的开始**
- **"$" : 匹配字符串的结束**
- **"{n}" : 重复 n 次**
- **"{n,}" : 重复 n 次或者 n 次以上**
- **"[字符]" : 匹配单个字符，如 [c]，匹配单个字符 c**
- **"[a-z]" : 匹配 a-z 小写字母的任意一个**
- **"/" 匹配域名的分隔符**
- **"\\" : 转义特殊字符**
- **".\\\*" 匹配任意文本**
- **"(.\*)" 匹配任意字符**
- **小括号 "()" 之间匹配的内容，可以在后面通过 "$1" 来引用，"$2" 表示的是前面第二个 "()" 里的内容**